<!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <title>Ù…Ø­ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ± - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>

Â  Â  <!-- CSS libraries remain in the head -->

Â  Â  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@14.3.0/dist/handsontable.min.css" />

Â  Â  <style>

Â  Â  Â  Â  /* --- Basic Setup --- */

Â  Â  Â  Â  * {

Â  Â  Â  Â  Â  Â  margin: 0;

Â  Â  Â  Â  Â  Â  padding: 0;

Â  Â  Â  Â  Â  Â  box-sizing: border-box;

Â  Â  Â  Â  }



Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

Â  Â  Â  Â  Â  Â  min-height: 100vh;

Â  Â  Â  Â  Â  Â  padding: 20px;

Â  Â  Â  Â  Â  Â  color: #333;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  justify-content: center;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* --- Main Container --- */

Â  Â  Â  Â  .container {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  max-width: 1600px;

Â  Â  Â  Â  Â  Â  margin: 0 auto;

Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.98);

Â  Â  Â  Â  Â  Â  border-radius: 20px;

Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* --- Header --- */

Â  Â  Â  Â  .header {

Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  padding: 30px;

Â  Â  Â  Â  Â  Â  text-align: center;

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  }



Â  Â  Â  Â  .header::before {

Â  Â  Â  Â  Â  Â  content: '';

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  top: -50%;

Â  Â  Â  Â  Â  Â  left: -50%;

Â  Â  Â  Â  Â  Â  width: 200%;

Â  Â  Â  Â  Â  Â  height: 200%;

Â  Â  Â  Â  Â  Â  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);

Â  Â  Â  Â  Â  Â  animation: pulse 4s ease-in-out infinite;

Â  Â  Â  Â  }



Â  Â  Â  Â  @keyframes pulse {

Â  Â  Â  Â  Â  Â  0%, 100% { transform: scale(1); opacity: 0.5; }

Â  Â  Â  Â  Â  Â  50% { transform: scale(1.1); opacity: 0.8; }

Â  Â  Â  Â  }



Â  Â  Â  Â  .header h1 {

Â  Â  Â  Â  Â  Â  font-size: 2.5em;

Â  Â  Â  Â  Â  Â  margin-bottom: 10px;

Â  Â  Â  Â  Â  Â  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  z-index: 1;

Â  Â  Â  Â  }



Â  Â  Â  Â  .header p {

Â  Â  Â  Â  Â  Â  font-size: 1.2em;

Â  Â  Â  Â  Â  Â  opacity: 0.9;

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  z-index: 1;

Â  Â  Â  Â  }



Â  Â  Â  Â  .ai-badge {

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  top: 15px;

Â  Â  Â  Â  Â  Â  right: 15px;

Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.2);

Â  Â  Â  Â  Â  Â  padding: 8px 15px;

Â  Â  Â  Â  Â  Â  border-radius: 20px;

Â  Â  Â  Â  Â  Â  font-size: 0.9em;

Â  Â  Â  Â  Â  Â  backdrop-filter: blur(10px);

Â  Â  Â  Â  }



Â  Â  Â  Â  /* --- Content Layout --- */

Â  Â  Â  Â  .content {

Â  Â  Â  Â  Â  Â  padding: 40px;

Â  Â  Â  Â  Â  Â  display: grid;

Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr 1fr;

Â  Â  Â  Â  Â  Â  gap: 30px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .panel {

Â  Â  Â  Â  Â  Â  background: #f8fafc;

Â  Â  Â  Â  Â  Â  border-radius: 15px;

Â  Â  Â  Â  Â  Â  padding: 25px;

Â  Â  Â  Â  Â  Â  border: 2px solid #e2e8f0;

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);

Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  }



Â  Â  Â  Â  .panel:hover {

Â  Â  Â  Â  Â  Â  transform: translateY(-2px);

Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);

Â  Â  Â  Â  }



Â  Â  Â  Â  .panel h3 {

Â  Â  Â  Â  Â  Â  color: #4f46e5;

Â  Â  Â  Â  Â  Â  margin-bottom: 20px;

Â  Â  Â  Â  Â  Â  font-size: 1.3em;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  gap: 10px;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* --- Input & Controls --- */

Â  Â  Â  Â  .input-section textarea {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  min-height: 350px;

Â  Â  Â  Â  Â  Â  padding: 20px;

Â  Â  Â  Â  Â  Â  border: 2px solid #e5e7eb;

Â  Â  Â  Â  Â  Â  border-radius: 15px;

Â  Â  Â  Â  Â  Â  font-size: 16px;

Â  Â  Â  Â  Â  Â  line-height: 1.6;

Â  Â  Â  Â  Â  Â  resize: vertical;

Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;

Â  Â  Â  Â  Â  Â  background: white;

Â  Â  Â  Â  Â  Â  font-family: 'Courier New', monospace;

Â  Â  Â  Â  }



Â  Â  Â  Â  .input-section textarea:focus {

Â  Â  Â  Â  Â  Â  outline: none;

Â  Â  Â  Â  Â  Â  border-color: #4f46e5;

Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .api-key-section {

Â  Â  Â  Â  Â  Â  margin-top: 15px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .api-key-section input {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  padding: 12px;

Â  Â  Â  Â  Â  Â  border: 2px solid #e5e7eb;

Â  Â  Â  Â  Â  Â  border-radius: 10px;

Â  Â  Â  Â  Â  Â  font-size: 14px;

Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;

Â  Â  Â  Â  }



Â  Â  Â  Â  .api-key-section input:focus {

Â  Â  Â  Â  Â  Â  outline: none;

Â  Â  Â  Â  Â  Â  border-color: #7c3aed;

Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);

Â  Â  Â  Â  }



Â  Â  Â  Â  .controls {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  gap: 10px;

Â  Â  Â  Â  Â  Â  flex-wrap: wrap;

Â  Â  Â  Â  Â  Â  margin-top: 20px;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .controls .btn { flex-grow: 1; }



Â  Â  Â  Â  .btn {

Â  Â  Â  Â  Â  Â  padding: 15px 20px;

Â  Â  Â  Â  Â  Â  border: none;

Â  Â  Â  Â  Â  Â  border-radius: 12px;

Â  Â  Â  Â  Â  Â  font-size: 14px;

Â  Â  Â  Â  Â  Â  font-weight: bold;

Â  Â  Â  Â  Â  Â  cursor: pointer;

Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;

Â  Â  Â  Â  Â  Â  text-transform: uppercase;

Â  Â  Â  Â  Â  Â  letter-spacing: 1px;

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  overflow: hidden;

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  justify-content: center;

Â  Â  Â  Â  Â  Â  gap: 8px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .btn:before {

Â  Â  Â  Â  Â  Â  content: '';

Â  Â  Â  Â  Â  Â  position: absolute;

Â  Â  Â  Â  Â  Â  top: 0;

Â  Â  Â  Â  Â  Â  left: -100%;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  height: 100%;

Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);

Â  Â  Â  Â  Â  Â  transition: left 0.5s;

Â  Â  Â  Â  }



Â  Â  Â  Â  .btn:hover:before { left: 100%; }

Â  Â  Â  Â  .btn:disabled { cursor: not-allowed; opacity: 0.6; }



Â  Â  Â  Â  .btn-primary { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; }

Â  Â  Â  Â  .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3); }

Â  Â  Â  Â  .btn-secondary { background: #f3f4f6; color: #374151; border: 2px solid #d1d5db; }

Â  Â  Â  Â  .btn-secondary:hover:not(:disabled) { background: #e5e7eb; border-color: #9ca3af; }

Â  Â  Â  Â  .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }

Â  Â  Â  Â  .btn-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; }

Â  Â  Â  Â  .btn-ai { background: linear-gradient(135deg, #ec4899 0%, #d946ef 100%); color: white; }

Â  Â  Â  Â  .btn-ai:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(236, 72, 153, 0.3); }



Â  Â  Â  Â  /* --- JSON Output --- */

Â  Â  Â  Â  .json-output {

Â  Â  Â  Â  Â  Â  background: #1e293b;

Â  Â  Â  Â  Â  Â  color: #e2e8f0;

Â  Â  Â  Â  Â  Â  padding: 20px;

Â  Â  Â  Â  Â  Â  border-radius: 12px;

Â  Â  Â  Â  Â  Â  font-family: 'Courier New', monospace;

Â  Â  Â  Â  Â  Â  font-size: 13px;

Â  Â  Â  Â  Â  Â  line-height: 1.4;

Â  Â  Â  Â  Â  Â  overflow-x: auto;

Â  Â  Â  Â  Â  Â  white-space: pre-wrap;

Â  Â  Â  Â  Â  Â  max-height: 500px;

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  border: 1px solid #334155;

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  margin-top: 15px;

Â  Â  Â  Â  }



Â  Â  Â  Â  .json-output .key { color: #60a5fa; }

Â  Â  Â  Â  .json-output .string { color: #34d399; }

Â  Â  Â  Â  .json-output .number { color: #fbbf24; }

Â  Â  Â  Â  .json-output .boolean { color: #f87171; }

Â  Â  Â  Â  .json-output .null { color: #a78bfa; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* --- Preview & Analysis --- */

Â  Â  Â  Â  .analysis-section { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #e2e8f0; }

Â  Â  Â  Â  .analysis-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f3f4f6; font-size: 0.9em; }

Â  Â  Â  Â  .analysis-item:last-child { border-bottom: none; }

Â  Â  Â  Â  .confidence-bar { width: 100px; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; }

Â  Â  Â  Â  .confidence-fill { height: 100%; background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); border-radius: 4px; transition: width 0.5s ease-in-out; }



Â  Â  Â  Â  #questionsPreview { flex-grow: 1; overflow-y: auto; max-height: 70vh; }

Â  Â  Â  Â  .question-preview { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); animation: fadeIn 0.5s ease; position: relative; }

Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .question-actions { position: absolute; top: 10px; left: 10px; display: none; gap: 8px; z-index: 10; }

Â  Â  Â  Â  .question-preview:hover .question-actions { display: flex; }

Â  Â  Â  Â  .action-btn { background: rgba(249, 250, 251, 0.8); border: 1px solid #d1d5db; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; backdrop-filter: blur(2px); }

Â  Â  Â  Â  .action-btn:hover { background: #4f46e5; border-color: #4f46e5; color: white; transform: scale(1.1); }

Â  Â  Â  Â  .action-btn:disabled { opacity: 0.4; cursor: not-allowed; background: #e5e7eb; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .question-preview h4 { color: #374151; margin-bottom: 10px; font-size: 1.1em; line-height: 1.5; }

Â  Â  Â  Â  .question-type-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: bold; margin-bottom: 10px; }

Â  Â  Â  Â  .type-multiple_choice { background: #dbeafe; color: #1e40af; }

Â  Â  Â  Â  .type-true_false { background: #fef3c7; color: #92400e; }

Â  Â  Â  Â  .type-fill_blank { background: #d1fae5; color: #065f46; }

Â  Â  Â  Â  .type-essay { background: #fce7f3; color: #be185d; }

Â  Â  Â  Â  .type-matching { background: #e0e7ff; color: #3730a3; }

Â  Â  Â  Â  .type-short_answer { background: #e5e7eb; color: #374151; }

Â  Â  Â  Â  .type-unknown { background: #fee2e2; color: #991b1b; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .choice-item { padding: 8px 15px; margin: 5px 0; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.2s ease; }

Â  Â  Â  Â  .choice-item:hover { background: #f3f4f6; border-color: #4f46e5; }

Â  Â  Â  Â  .choice-item.correct { background: #dcfce7; border-color: #16a34a; color: #15803d; font-weight: bold; }

Â  Â  Â  Â  .choice-item.correct::before { content: 'âœ” '; color: #15803d; }

Â  Â  Â  Â Â 

Â  Â  Â  Â  .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px; }

Â  Â  Â  Â  .stat-card { background: white; padding: 15px; border-radius: 12px; text-align: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); border: 1px solid #e5e7eb; transition: all 0.3s ease; }

Â  Â  Â  Â  .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08); }

Â  Â  Â  Â  .stat-card h4 { color: #4f46e5; margin-bottom: 10px; font-size: 0.9em; }

Â  Â  Â  Â  .stat-card span { font-size: 2em; font-weight: bold; color: #1f2937; }



Â  Â  Â  Â  /* --- Loading & Messages --- */

Â  Â  Â  Â  .loading { display: none; text-align: center; padding: 20px; }

Â  Â  Â  Â  .spinner { border: 4px solid #f3f4f6; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }

Â  Â  Â  Â  .btn .spinner { width: 20px; height: 20px; margin: 0; }

Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }



Â  Â  Â  Â  .message-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; flex-direction: column; align-items: center; gap: 10px; }

Â  Â  Â  Â  .message { padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); animation: slideIn 0.5s ease, fadeOut 0.5s ease 3.5s forwards; font-weight: 500; min-width: 300px; text-align: center; }

Â  Â  Â  Â  .message.error { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }

Â  Â  Â  Â  .message.success { background: #dcfce7; color: #065f46; border: 1px solid #a7f3d0; }

Â  Â  Â  Â  .message.warning { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }

Â  Â  Â  Â  @keyframes slideIn { from { transform: translateY(-50px) translateX(-50%); opacity: 0; } to { transform: translateY(0) translateX(-50%); opacity: 1; } }

Â  Â  Â  Â  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: translateY(-20px) translateX(-50%); } }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* --- NEW: CSV Modal Styles --- */

Â  Â  Â  Â  #csvModalBg {

Â  Â  Â  Â  Â  Â  display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;

Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.25); z-index: 3000; align-items: center; justify-content: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  #csvModal {

Â  Â  Â  Â  Â  Â  background: white; border-radius: 16px; max-width: 1200px; width: 95vw; padding: 32px 24px;

Â  Â  Â  Â  Â  Â  box-shadow: 0 8px 32px rgba(0,0,0,0.15); position: relative; min-height: 600px; min-width: 900px;

Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center; justify-content: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  #csvModal .hot-container { margin-bottom: 18px; width: 100%; }

Â  Â  Â  Â  #csvModal .btn { min-width: 120px; }

Â  Â  Â  Â  #csvModal .csv-warning { color: #dc2626; font-weight: bold; margin-bottom: 10px; }



Â  Â  Â  Â  /* --- Responsive Design --- */

Â  Â  Â  Â  @media (max-width: 1200px) { .content { grid-template-columns: 1fr 1fr; } }

Â  Â  Â  Â  @media (max-width: 768px) { body { padding: 10px; } .content { grid-template-columns: 1fr; padding: 20px; } .header h1 { font-size: 2em; } .header p { font-size: 1em; } .controls { flex-direction: column; } .btn { width: 100%; } }

Â  Â  </style>

</head>

<body>

Â  Â  <div id="messageContainer" class="message-container"></div>

Â  Â  <div class="container">

Â  Â  Â  Â  <div class="header">

Â  Â  Â  Â  Â  Â  <div class="ai-badge">ğŸ¤– AI Powered</div>

Â  Â  Â  Â  Â  Â  <h1>ğŸš€ Ù…Ø­ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±</h1>

Â  Â  Â  Â  Â  Â  <p>Ø­ÙˆÙ‘Ù„ Ù†ØµÙˆØµ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¥Ù„Ù‰ ØµÙŠØºØ© JSON Ù…ØªÙ‚Ø¯Ù…Ø© Ø¨Ø¶ØºØ·Ø© Ø²Ø±</p>

Â  Â  Â  Â  </div>



Â  Â  Â  Â  <div class="content">

Â  Â  Â  Â  Â  Â  <!-- Input Panel -->

Â  Â  Â  Â  Â  Â  <div class="panel">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ“ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-section">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="questionInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§... Ù…Ø«Ø§Ù„:

1. Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ

Ø£) Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©*

Ø¨) Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©

**********

2. Ø§Ù„Ø´Ù…Ø³ ØªØ´Ø±Ù‚ Ù…Ù† Ø§Ù„ØºØ±Ø¨. (Ø®Ø·Ø£)

**********

3. Ø£ÙƒÙ…Ù„: Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù‡ÙŠ _________

"></textarea>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="api-key-section">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <input type="password" id="apiKey" placeholder="ğŸ”‘ Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Gemini API Ù‡Ù†Ø§">

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="controls">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" onclick="app.smartAnalyze()">ğŸ¤– ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-ai" id="aiEnhanceBtn" onclick="app.enhanceWithAI()">ğŸ’ ØªØ­Ø³ÙŠÙ† Ø¨Ø§Ù„Ù€ AI</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="customizeBtn" onclick="app.openCustomizeModal()">âš™ï¸ ØªØ®ØµÙŠØµ</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-warning" id="langSwitchBtn" onclick="app.toggleLanguage()">ğŸŒ English</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â <div class="controls">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-success" onclick="app.convertToJSON()">ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ù„Ù€ JSON Ù…ØªÙ‚Ø¯Ù…</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="app.clearAll()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="loading" id="loading">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="spinner"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <!-- Analysis & Output Panel -->

Â  Â  Â  Â  Â  Â  <div class="panel">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ” ØªØ­Ù„ÙŠÙ„ ÙˆÙ…Ø®Ø±Ø¬Ø§Øª</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="analysis-section" id="analysisSection">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="analysis-item"><span>Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒØ´Ù:</span><div class="confidence-bar"><div id="detectionQuality" class="confidence-fill" style="width: 0%"></div></div></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="analysis-item"><span>Ø¯Ù‚Ø© Ø§Ù„ØªØµÙ†ÙŠÙ:</span><div class="confidence-bar"><div id="classificationAccuracy" class="confidence-fill" style="width: 0%"></div></div></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="analysis-item"><span>Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</span><div class="confidence-bar"><div id="dataCompleteness" class="confidence-fill" style="width: 0%"></div></div></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="stats" id="stats">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card"><h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h4><span id="totalQuestions">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card"><h4>Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯</h4><span id="multipleChoice">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card"><h4>ØµØ­/Ø®Ø·Ø£</h4><span id="trueFalse">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card"><h4>Ù…Ù‚Ø§Ù„ÙŠØ©</h4><span id="essay">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card"><h4>ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</h4><span id="unknown">0</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card"><h4>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø«Ù‚Ø©</h4><span id="confidenceScore">0%</span></div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="json-output" id="jsonOutput" style="display: none;"></div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="controls" style="margin-top: auto;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="copyBtn" onclick="app.copyJSON()" disabled>ğŸ“‹ Ù†Ø³Ø® JSON</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-warning" id="downloadBtn" onclick="app.downloadJSON()" disabled>ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-warning" id="downloadZipBtn" onclick="app.downloadZip()" disabled>ğŸ—œï¸ ØªØ­Ù…ÙŠÙ„ ÙƒÙ€ ZIP</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <!-- NEW: CSV Button -->

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="csvBtn" onclick="app.openCSVModal()" disabled>ğŸ“„ CSV</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  <!-- Preview Panel -->

Â  Â  Â  Â  Â  Â  <div class="panel">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="questionsPreview">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="text-align: center; color: #6b7280; padding: 40px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 3em; margin-bottom: 20px;">ğŸ“‹</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <div id="customizeModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:2000; align-items:center; justify-content:center;">

Â  Â  Â  Â  <div style="background:white; border-radius:16px; max-width:400px; width:90vw; padding:32px 24px; box-shadow:0 8px 32px rgba(0,0,0,0.15); position:relative;">

Â  Â  Â  Â  Â  Â  <button onclick="app.closeCustomizeModal()" style="position:absolute; top:12px; left:12px; background:none; border:none; font-size:1.5em; cursor:pointer;">&times;</button>

Â  Â  Â  Â  Â  Â  <h2 style="text-align:center; margin-bottom:24px; color:#4f46e5;">ØªØ®ØµÙŠØµ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>

Â  Â  Â  Â  Â  Â  <div style="margin-bottom:18px;">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="categorySelect" style="font-weight:bold;">Category</label>

Â  Â  Â  Â  Â  Â  Â  Â  <select id="categorySelect" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb; margin-top:6px;"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="app.handleCustomizationChange()">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="lesson" selected>lesson</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="exam">exam</option>

Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <!-- NEW: Lang Dropdown -->

Â  Â  Â  Â  Â  Â  <div style="margin-bottom:18px;">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="langSelect" style="font-weight:bold;">Lang</label>

Â  Â  Â  Â  Â  Â  Â  Â  <select id="langSelect" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb; margin-top:6px;"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="app.handleCustomizationChange()">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ar" selected>ar</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="eg">eg</option>

Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div style="margin-bottom:18px;">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="countrySelect" style="font-weight:bold;">Country</label>

Â  Â  Â  Â  Â  Â  Â  Â  <select id="countrySelect" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb; margin-top:6px;"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="app.handleCustomizationChange()">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="eg" selected>eg</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="bh">bh</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cn">cn</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="dj">dj</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="fr">fr</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="in">in</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="iq">iq</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="jm">jm</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="jo">jo</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="kw">kw</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="lb">lb</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="om">om</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="pt">pt</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="qa">qa</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="sa">sa</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ae">ae</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="uk">uk</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="us">us</option>

Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div style="margin-bottom:24px;">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="dialectSelect" style="font-weight:bold;">Dialect</label>

Â  Â  Â  Â  Â  Â  Â  Â  <select id="dialectSelect" style="width:100%; padding:10px; border-radius:8px; border:1px solid #e5e7eb; margin-top:6px;"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onchange="app.handleCustomizationChange()">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Modern_standard" selected>Modern_standard</option>

Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" style="width:100%;" onclick="app.saveCustomization()">Ø­ÙØ¸</button>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <!-- NEW: Handsontable CSV Modal -->

Â  Â  <div id="csvModalBg" style="display:none;">

Â  Â  Â  Â  <div id="csvModal">

Â  Â  Â  Â  Â  Â  <button onclick="app.closeCSVModal()" style="position:absolute; top:12px; left:12px; background:none; border:none; font-size:1.5em; cursor:pointer;">&times;</button>

Â  Â  Â  Â  Â  Â  <h2 style="text-align:center; margin-bottom:18px; color:#4f46e5;">CSV Editor</h2>

Â  Â  Â  Â  Â  Â  <div class="csv-warning" id="csvWarning" style="display:none;"></div>

Â  Â  Â  Â  Â  Â  <div id="hotTable" class="hot-container"></div>

Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px; justify-content:center; margin-top:18px;">

Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-success" onclick="app.saveCSVData()">ğŸ’¾ Ø­ÙØ¸</button>

Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="app.closeCSVModal()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <!-- FIX: All scripts are moved to the end of the body for robust loading -->

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/handsontable@14.3.0/dist/handsontable.min.js"></script>

Â  Â  <script>

Â  Â  Â  Â  class AIQuestionConverter {

Â  Â  Â  Â  Â  Â  constructor() {

Â  Â  Â  Â  Â  Â  Â  Â  this.questions = [];

Â  Â  Â  Â  Â  Â  Â  Â  this.isAIProcessing = false;

Â  Â  Â  Â  Â  Â  Â  Â  this.jsonForExport = '';

Â  Â  Â  Â  Â  Â  Â  Â  this.customization = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: 'lesson',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: 'eg',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dialect: 'Modern_standard',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lang: 'ar' // NEW: Default lang

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  this.language = 'ar'; // For UI translation

Â  Â  Â  Â  Â  Â  Â  Â  this.apiKey = '';

Â  Â  Â  Â  Â  Â  Â  Â  // NEW: CSV Properties

Â  Â  Â  Â  Â  Â  Â  Â  this.csvData = [];

Â  Â  Â  Â  Â  Â  Â  Â  this.hotInstance = null;

Â  Â  Â  Â  Â  Â  Â  Â  this.patterns = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  multipleChoice: /([Ø£-ÙŠ]\s*[.)-]|^\d+\s*[.)-])/m,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  trueFalse: /(ØµØ­\s*(Ø£Ù…|Ø£Ùˆ|\/)\s*Ø®Ø·Ø£|true\s*(or|\/)\s*false)/i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fillBlank: /(____+|\[\s*.*?s*\]|\{\s*.*?s*\}|\(\s*.*?s*\)|Ø£ÙƒÙ…Ù„|Ø§Ù…Ù„Ø£)/i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  matching: /(ØµÙ„|Ø§Ø±Ø¨Ø·|ÙˆØµÙ„|Ø·Ø§Ø¨Ù‚)/i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  essay: /(Ø§Ø´Ø±Ø­|ÙˆØ¶Ø­|Ù†Ø§Ù‚Ø´|ØªØ­Ø¯Ø«|Ø§ÙƒØªØ¨|ØµÙ|Ø¹Ù„Ù„|Ø¨Ø±Ø±|Ù…Ø§ Ø±Ø£ÙŠÙƒ|Ù„Ù…Ø§Ø°Ø§|ÙƒÙŠÙ)/i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  en_multipleChoice: /([A-Da-d]\s*[.)-]|^\d+\s*[.)-])/m,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  en_trueFalse: /(true\s*(or|\/)\s*false)/i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  en_essay: /(explain|describe|discuss|write|why|how|justify|reason)/i

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  this.loadSettings();

Â  Â  Â  Â  Â  Â  Â  Â  this.loadApiKey();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== Main Actions =====



Â  Â  Â  Â  Â  Â  smartAnalyze() {

Â  Â  Â  Â  Â  Â  Â  Â  const input = document.getElementById('questionInput').value.trim();

Â  Â  Â  Â  Â  Â  Â  Â  if (!input) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„ØªØ­Ù„ÙŠÙ„', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  this.showLoading(true, 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ...');

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.processText(input);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }, 500);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  async enhanceWithAI() {

Â  Â  Â  Â  Â  Â  Â  Â  const apiKey = document.getElementById('apiKey').value.trim();

Â  Â  Â  Â  Â  Â  Â  Â  if (!apiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Gemini API Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (this.questions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ù…Ø¨Ø¯Ø¦ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (this.isAIProcessing) return;



Â  Â  Â  Â  Â  Â  Â  Â  this.isAIProcessing = true;

Â  Â  Â  Â  Â  Â  Â  Â  this.toggleAIButtonLoading(true);



Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rawText = document.getElementById('questionInput').value;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const prompt = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  You are an expert system for structuring test questions from raw text into precise JSON format.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Task: Analyze the following raw text containing questions.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Your job is to correct any errors and return a single, valid JSON array containing all question objects, properly structured.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Each object must have "id", "type", "question", "choices" (if any), "answer" (the index of the correct choice, or the correct text), and a "confidence" score (0.0 to 1.0).

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  The "type" can be "multiple_choice", "true_false", "essay", "short_answer", "fill_blank", or "matching".



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Raw Text:

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ---

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${rawText}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ---

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  IMPORTANT: Return ONLY the raw JSON array. Do not include any explanatory text, markdown formatting like \`\`\`json, or anything else. Your entire response must be the JSON array itself.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const aiResult = await this.callGeminiAPI(prompt, apiKey);



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (aiResult && Array.isArray(aiResult)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.questions = aiResult;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange('ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â this.showMessage('Ø§Ø³ØªØ¬Ø§Ø¨ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨ØµÙŠØºØ© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©.', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('AI Enhancement Error:', error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage(`Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ AI: ${error.message}`, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.isAIProcessing = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.toggleAIButtonLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  transformToAdvancedFormat(question, index, forceN = null) {

Â  Â  Â  Â  Â  Â  Â  Â  const typeMap = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  multiple_choice: 'mcq',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  true_false: 'mcq',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  essay: 'essay',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fill_blank: 'fill_blank',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  short_answer: 'short_answer',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  matching: 'matching',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unknown: 'essay'

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  const partN = (forceN !== null) ? forceN : (question.id || index + 1);



Â  Â  Â  Â  Â  Â  Â  Â  const csvRow = this.csvData && this.csvData[index];

Â  Â  Â  Â  Â  Â  Â  Â  const questionIdFromCsv = csvRow && csvRow['Question Id'] ? String(csvRow['Question Id']).trim() : null;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let finalId;

Â  Â  Â  Â  Â  Â  Â  Â  if (questionIdFromCsv) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const parsedId = parseInt(questionIdFromCsv, 10);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalId = !isNaN(parsedId) ? parsedId : Date.now() + index;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalId = Date.now() + index;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  let questionText = question.question;

Â  Â  Â  Â  Â  Â  Â  Â  const blankLineSpanHtml = '<span data-node-type="blank-line" data-node-variation="space">&nbsp;</span>';

Â  Â  Â  Â  Â  Â  Â  Â  const fillBlankPlaceholder = "###FILL_BLANK_SPAN###";

Â  Â  Â  Â  Â  Â  Â  Â  const mcqEndPlaceholder = "###MCQ_END_SPAN###";



Â  Â  Â  Â  Â  Â  Â  Â  questionText = questionText.replace(/_{2,}/g, fillBlankPlaceholder);



Â  Â  Â  Â  Â  Â  Â  Â  if (question.type === 'multiple_choice') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let textToCheck = question.question.trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (textToCheck.endsWith('.')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textToCheck = textToCheck.slice(0, -1).trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!textToCheck.endsWith('ØŸ') && !textToCheck.endsWith('ØŸ')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let originalTrimmedText = question.question.trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (originalTrimmedText.endsWith('.')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionText = originalTrimmedText.slice(0, -1).trim() + mcqEndPlaceholder + '.';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionText = originalTrimmedText + mcqEndPlaceholder;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  let escapedQuestionText = this.escapeHtml(questionText);



Â  Â  Â  Â  Â  Â  Â  Â  let finalStemHtml = escapedQuestionText.replace(new RegExp(fillBlankPlaceholder, 'g'), blankLineSpanHtml);

Â  Â  Â  Â  Â  Â  Â  Â  finalStemHtml = finalStemHtml.replace(new RegExp(mcqEndPlaceholder, 'g'), blankLineSpanHtml);



Â  Â  Â  Â  Â  Â  Â  Â  const part = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  n: partN,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stem: `<p>${finalStemHtml}</p>`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: typeMap[question.type] || 'essay',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  answer: null,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  choices: [],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtype: null,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  standalone: true,

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  if (question.type === 'multiple_choice' && Array.isArray(question.choices) && question.choices.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let correctAnswerIndex = question.answer;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (correctAnswerIndex === null || correctAnswerIndex === undefined) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correctAnswerIndex = 0;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  part.choices = question.choices.map((choice, i) => ({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: (i === correctAnswerIndex) ? 'key' : 'distractor',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  unit: null,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  index: i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  values: [],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  last_order: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fixed_order: i + 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html_content: `<span>${this.escapeHtml(choice)}</span>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  else if (question.type === 'true_false') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let correctAnswerIndex = question.answer;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (correctAnswerIndex === null || correctAnswerIndex === undefined) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correctAnswerIndex = 0;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const choices = (this.language === 'ar') ? ['ØµØ­', 'Ø®Ø·Ø£'] : ['True', 'False'];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  part.choices = choices.map((choice, i) => ({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type: (i === correctAnswerIndex) ? 'key' : 'distractor',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â unit: null,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â index: i,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â values: [],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â last_order: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â fixed_order: i + 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â html_content: `<span>${this.escapeHtml(choice)}</span>`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const advancedQuestion = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parts: [part],Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  metadata: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: finalId,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: "",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  automark: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  category: this.customization.category,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  country: this.customization.country,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  language: this.customization.lang,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dialect: [this.customization.dialect],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mapped_id: finalId,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source_id: { value: question.id || index + 1, page_number: null },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: question.question,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  has_example: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parts_count: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  instances_count: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  publication_date: new Date().toISOString()

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statement: null

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  return advancedQuestion;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  convertToJSON() {

Â  Â  Â  Â  Â  Â  Â  Â  if (this.questions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„Ù‡Ø§. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const advancedFormatQuestions = this.questions.map((q, index) => this.transformToAdvancedFormat(q, index));

Â  Â  Â  Â  Â  Â  Â  Â  const jsonOutput = document.getElementById('jsonOutput');

Â  Â  Â  Â  Â  Â  Â  Â  this.jsonForExport = JSON.stringify(advancedFormatQuestions, null, 2);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  jsonOutput.innerHTML = this.syntaxHighlight(this.jsonForExport);

Â  Â  Â  Â  Â  Â  Â  Â  jsonOutput.style.display = 'block';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('copyBtn').disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadBtn').disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadZipBtn').disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('csvBtn').disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  clearAll() {

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('questionInput').value = '';

Â  Â  Â  Â  Â  Â  Â  Â  this.questions = [];

Â  Â  Â  Â  Â  Â  Â  Â  this.jsonForExport = '';

Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange();

Â  Â  Â  Â  Â  Â  Â  Â  const jsonOutput = document.getElementById('jsonOutput');

Â  Â  Â  Â  Â  Â  Â  Â  jsonOutput.style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  jsonOutput.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('copyBtn').disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadBtn').disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadZipBtn').disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('csvBtn').disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.removeItem('aiq_csv_data');

Â  Â  Â  Â  Â  Â  Â  Â  this.csvData = [];

Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡', 'success');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  copyJSON() {

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.jsonForExport) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠØ¡ Ù„Ù†Ø³Ø®Ù‡', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const textArea = document.createElement('textarea');

Â  Â  Â  Â  Â  Â  Â  Â  textArea.value = this.jsonForExport;

Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(textArea);

Â  Â  Â  Â  Â  Â  Â  Â  textArea.select();

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand('copy');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ØªÙ… Ù†Ø³Ø® JSON Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(textArea);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  downloadJSON() {

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.jsonForExport) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´ÙŠØ¡ Ù„ØªØ­Ù…ÙŠÙ„Ù‡', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const blob = new Blob([this.jsonForExport], { type: 'application/json' });

Â  Â  Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);

Â  Â  Â  Â  Â  Â  Â  Â  const a = document.createElement('a');

Â  Â  Â  Â  Â  Â  Â  Â  a.href = url;

Â  Â  Â  Â  Â  Â  Â  Â  a.download = 'advanced_questions.json';

Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(a);

Â  Â  Â  Â  Â  Â  Â  Â  a.click();

Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(a);

Â  Â  Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);

Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...', 'success');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  downloadZip() {

Â  Â  Â  Â  Â  Â  Â  Â  if (this.questions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (typeof JSZip === 'undefined') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø®Ø·Ø£: Ù…ÙƒØªØ¨Ø© ZIP ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©.', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const zip = new JSZip();

Â  Â  Â  Â  Â  Â  Â  Â  const jsonFolder = zip.folder("JSONS");



Â  Â  Â  Â  Â  Â  Â  Â  this.questions.forEach((q, idx) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const filename = (this.csvData && this.csvData[idx] && this.csvData[idx]['Question Id'])

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `${this.csvData[idx]['Question Id']}.json`

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `question_${q.id || idx + 1}.json`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const singleQuestionObject = this.transformToAdvancedFormat(q, idx, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const content = JSON.stringify(singleQuestionObject, null, 2);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  jsonFolder.file(filename, content);

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  if (this.csvData && this.csvData.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  zip.file('questions.csv', this.getCSVString());

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  zip.generateAsync({ type: 'blob' }).then((blob) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const a = document.createElement('a');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  a.href = url;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  a.download = 'questions.zip';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(a);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  a.click();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(a);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ZIP Ø¨Ù†Ø¬Ø§Ø­', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== Editing Logic =====



Â  Â  Â  Â  Â  Â  deleteQuestion(id) {

Â  Â  Â  Â  Â  Â  Â  Â  const questionIndex = this.questions.findIndex(q => q.id === id);

Â  Â  Â  Â  Â  Â  Â  Â  if (questionIndex > -1) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.questions.splice(questionIndex, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  mergeQuestions(id) {

Â  Â  Â  Â  Â  Â  Â  Â  const questionIndex = this.questions.findIndex(q => q.id === id);

Â  Â  Â  Â  Â  Â  Â  Â  if (questionIndex > -1 && questionIndex < this.questions.length - 1) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentQuestion = this.questions[questionIndex];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nextQuestion = this.questions[questionIndex + 1];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mergedText = (currentQuestion.originalText || currentQuestion.question) + '\n\n' + (nextQuestion.originalText || nextQuestion.question);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reAnalyzedQuestion = this.analyzeQuestion(mergedText, currentQuestion.id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reAnalyzedQuestion.originalText = mergedText;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.questions[questionIndex] = reAnalyzedQuestion;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.questions.splice(questionIndex + 1, 1);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange('ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¤Ø§Ù„ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== Customization Modal =====

Â  Â  Â  Â  Â  Â  openCustomizeModal() {

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customizeModal').style.display = 'flex';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('categorySelect').value = this.customization.category;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('countrySelect').value = this.customization.country;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dialectSelect').value = this.customization.dialect;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('langSelect').value = this.customization.lang;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  closeCustomizeModal() {

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customizeModal').style.display = 'none';

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  saveCustomization() {

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.category = document.getElementById('categorySelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.country = document.getElementById('countrySelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.dialect = document.getElementById('dialectSelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.lang = document.getElementById('langSelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.closeCustomizeModal();

Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  handleCustomizationChange() {

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.category = document.getElementById('categorySelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.country = document.getElementById('countrySelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.dialect = document.getElementById('dialectSelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.customization.lang = document.getElementById('langSelect').value;

Â  Â  Â  Â  Â  Â  Â  Â  this.saveSettings();

Â  Â  Â  Â  Â  Â  Â  Â  const jsonOutput = document.getElementById('jsonOutput');

Â  Â  Â  Â  Â  Â  Â  Â  if (jsonOutput && jsonOutput.style.display === 'block') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.convertToJSON();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== Core Processing Logic =====

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  processText(text) {

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const questionBlocks = this.intelligentQuestionSplitting(text);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (questionBlocks.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„.', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.questions = questionBlocks.map((block, index) => this.analyzeQuestion(block, index + 1));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange('ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ Ø¨Ù†Ø¬Ø§Ø­.');

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ' + error.message, 'error');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  intelligentQuestionSplitting(text) {

Â  Â  Â  Â  Â  Â  Â  Â  return text.split(/\n\s*\*+\s*\n|(?=\n*\s*\d+\s*[.-])/)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .filter(block => block && block.trim().length > 5)Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .map(b => b.trim());

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  analyzeQuestion(block, id) {

Â  Â  Â  Â  Â  Â  Â  Â  const type = this.detectQuestionType(block);

Â  Â  Â  Â  Â  Â  Â  Â  let structure = { question: block, answer: null };

Â  Â  Â  Â  Â  Â  Â  Â  let confidence = 0.5;



Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  switch (type) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'multiple_choice': structure = this.analyzeMultipleChoice(block); confidence = 0.9; break;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'true_false': structure = this.analyzeTrueFalse(block); confidence = 0.95; break;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  case 'fill_blank': structure = { question: block.replace(/^\d+\s*[.-]\s*/, '').trim(), answer: null }; confidence = 0.85; break;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  default: structure = { question: block.replace(/^\d+\s*[.-]\s*/, '').trim(), answer: null }; confidence = 0.6;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } catch {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  structure = { question: block, answer: null };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confidence = 0.3;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  return { id, originalText: block, type, confidence: Math.min(confidence, 1.0), ...structure };

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  detectQuestionType(text) {

Â  Â  Â  Â  Â  Â  Â  Â  const hasChoices = (lang) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lines = text.split('\n').map(l => l.trim());

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (lines.length < 2) return false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const choicePattern = (lang === 'ar') ? /^[Ø£-ÙŠ]\s*[.)-]/ : /^[A-Da-d]\s*[.)-]/;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const choiceCount = lines.slice(1).filter(line => choicePattern.test(line)).length;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return choiceCount >= 2;

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  const hasFillBlank = this.patterns.fillBlank.test(text);

Â  Â  Â  Â  Â  Â  Â  Â  const hasTrueFalse = this.patterns.trueFalse.test(text);

Â  Â  Â  Â  Â  Â  Â  Â  const hasEssay = this.patterns.essay.test(text);



Â  Â  Â  Â  Â  Â  Â  Â  if (hasChoices(this.language)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'multiple_choice';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (hasTrueFalse) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'true_false';

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if (hasFillBlank) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'fill_blank';

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if (hasEssay) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'essay';

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  return 'unknown';

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== MODIFIED FUNCTION =====

Â  Â  Â  Â  Â  Â  analyzeMultipleChoice(text) {

Â  Â  Â  Â  Â  Â  Â  Â  const lines = text.split('\n').filter(line => line.trim() !== '');

Â  Â  Â  Â  Â  Â  Â  Â  let question = lines[0].replace(/^\d+\s*[.-]\s*/, '').trim();

Â  Â  Â  Â  Â  Â  Â  Â  const choices = [];

Â  Â  Â  Â  Â  Â  Â  Â  let correctAnswerIndex = null;



Â  Â  Â  Â  Â  Â  Â  Â  // Check if the question is interrogative

Â  Â  Â  Â  Â  Â  Â  Â  const isInterrogative = question.trim().endsWith('ØŸ');



Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 1; i < lines.length; i++) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let choiceText = lines[i];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (this.language === 'ar') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  choiceText = choiceText.replace(/^[Ø£-ÙŠ]\s*[.)-]\s*/, '');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  choiceText = choiceText.replace(/^[A-Da-d]\s*[.)-]\s*/, '');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (choiceText.includes('*')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  correctAnswerIndex = choices.length;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  choiceText = choiceText.replace(/\*/g, '');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cleanedText = choiceText.trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Clean any existing trailing punctuation

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cleanedText = cleanedText.replace(/[.ØŸ?!,;:]\s*$/, '');



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Add a period only if the question IS interrogative

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isInterrogative) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cleanedText += '.';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  choices.push(cleanedText);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return { question, choices, answer: correctAnswerIndex };

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  analyzeTrueFalse(text) {

Â  Â  Â  Â  Â  Â  Â  Â  let question, answer = null;

Â  Â  Â  Â  Â  Â  Â  Â  if (this.language === 'ar') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question = text.replace(/(ØµØ­\s*(Ø£Ù…|Ø£Ùˆ|\/)\s*Ø®Ø·Ø£)/i, '').trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const match = text.match(/\((.*?)\)/);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (match) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const answerText = match[1].trim().toLowerCase();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (answerText === 'ØµØ­') answer = 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (answerText === 'Ø®Ø·Ø£') answer = 1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question = question.replace(/\(.*?\)/, '').trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { question, choices: ['ØµØ­', 'Ø®Ø·Ø£'], answer };

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question = text.replace(/(true\s*(or|\/)\s*false)/i, '').trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const match = text.match(/\((.*?)\)/);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (match) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const answerText = match[1].trim().toLowerCase();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (answerText === 'true') answer = 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (answerText === 'false') answer = 1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  question = question.replace(/\(.*?\)/, '').trim();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { question, choices: ['True', 'False'], answer };

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== UI Update & Utility Functions =====



Â  Â  Â  Â  Â  Â  updateUIAfterChange(message) {

Â  Â  Â  Â  Â  Â  Â  Â  this.questions.forEach((q, index) => { q.id = index + 1; });

Â  Â  Â  Â  Â  Â  Â  Â  this.updateStatistics();

Â  Â  Â  Â  Â  Â  Â  Â  this.displayResults();

Â  Â  Â  Â  Â  Â  Â  Â  const jsonOutput = document.getElementById('jsonOutput');

Â  Â  Â  Â  Â  Â  Â  Â  if (jsonOutput.style.display === 'block') { this.convertToJSON(); }

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadZipBtn').disabled = this.questions.length === 0;

Â  Â  Â  Â  Â  Â  Â  Â  if (message) { this.showMessage(message, 'success'); }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  showLoading(isLoading, text = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {

Â  Â  Â  Â  Â  Â  Â  Â  const loadingDiv = document.getElementById('loading');

Â  Â  Â  Â  Â  Â  Â  Â  loadingDiv.querySelector('p').textContent = text;

Â  Â  Â  Â  Â  Â  Â  Â  loadingDiv.style.display = isLoading ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  toggleAIButtonLoading(isLoading) {

Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.getElementById('aiEnhanceBtn');

Â  Â  Â  Â  Â  Â  Â  Â  if (isLoading) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = '<div class="spinner"></div> <span>Ø¬Ø§Ø±ÙŠ...</span>';

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.disabled = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = 'ğŸ’ ØªØ­Ø³ÙŠÙ† Ø¨Ø§Ù„Ù€ AI';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  showMessage(text, type = 'success') {

Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('messageContainer');

Â  Â  Â  Â  Â  Â  Â  Â  const messageDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.className = `message ${type}`;

Â  Â  Â  Â  Â  Â  Â  Â  messageDiv.textContent = text;

Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(messageDiv);

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { messageDiv.remove(); }, 4000);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  updateStatistics() {

Â  Â  Â  Â  Â  Â  Â  Â  const counts = { multiple_choice: 0, true_false: 0, essay: 0, unknown: 0, fill_blank: 0 };

Â  Â  Â  Â  Â  Â  Â  Â  let totalConfidence = 0;

Â  Â  Â  Â  Â  Â  Â  Â  this.questions.forEach(q => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  counts[q.type] = (counts[q.type] || 0) + 1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalConfidence += (q.confidence || 0.5);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const total = this.questions.length;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('totalQuestions').textContent = total;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('multipleChoice').textContent = counts.multiple_choice;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('trueFalse').textContent = counts.true_false;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('essay').textContent = counts.essay;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('unknown').textContent = counts.unknown;



Â  Â  Â  Â  Â  Â  Â  Â  const avgConfidence = total > 0 ? (totalConfidence / total) : 0;

Â  Â  Â  Â  Â  Â  Â  Â  const confidencePercent = Math.round(avgConfidence * 100);

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('confidenceScore').textContent = `${confidencePercent}%`;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('detectionQuality').style.width = `${confidencePercent}%`;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('classificationAccuracy').style.width = `${Math.round(avgConfidence * 95)}%`;

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dataCompleteness').style.width = `${Math.round(avgConfidence * 90)}%`;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  displayResults() {

Â  Â  Â  Â  Â  Â  Â  Â  const previewContainer = document.getElementById('questionsPreview');

Â  Â  Â  Â  Â  Â  Â  Â  previewContainer.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (this.questions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewContainer.innerHTML = `<div style="text-align: center; color: #6b7280; padding: 40px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 3em; margin-bottom: 20px;">ğŸ“‹</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  this.questions.forEach((q, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const questionDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionDiv.className = 'question-preview';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const typeTranslations = { multiple_choice: 'Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯', true_false: 'ØµØ­ / Ø®Ø·Ø£', fill_blank: 'Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº', essay: 'Ù…Ù‚Ø§Ù„ÙŠ', matching: 'Ù…Ø·Ø§Ø¨Ù‚Ø©', short_answer: 'Ø¥Ø¬Ø§Ø¨Ø© Ù‚ØµÙŠØ±Ø©', unknown: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const questionIdText = (this.csvData && this.csvData[index] && this.csvData[index]['Question Id']) || q.id;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (q._editing) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let editContent = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="question-type-badge type-${q.type || 'unknown'}">${typeTranslations[q.type] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="edit-question-${q.id}" style="width:100%;margin-bottom:10px;">${this.escapeHtml(q.question)}</textarea>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (q.choices) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editContent += q.choices.map((choice, i) => `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="edit-choice-${q.id}-${i}" type="text" value="${this.escapeHtml(choice)}" style="width:100%;margin-bottom:6px;" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  editContent += `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top:10px;display:flex;gap:10px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-success" onclick="app.saveEditQuestion(${q.id})">ğŸ’¾ Ø­ÙØ¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" onclick="app.cancelEditQuestion(${q.id})">âŒ Ø¥Ù„ØºØ§Ø¡</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionDiv.innerHTML = editContent;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let content = `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="question-actions">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" onclick="app.mergeQuestions(${q.id})" title="Ø¯Ù…Ø¬ Ù…Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ" ${index === this.questions.length - 1 ? 'disabled' : ''}>ğŸ”—</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" onclick="app.deleteQuestion(${q.id})" title="Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„">ğŸ—‘ï¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" onclick="app.startEditQuestion(${q.id})" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„">âœï¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="question-type-badge type-${q.type || 'unknown'}">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${typeTranslations[q.type] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'} | ID: ${questionIdText}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>${q.id}. <span class="question-stem" style="display:inline;">${this.escapeHtml(q.question)}</span></h4>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (q.choices) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  content += q.choices.map((choice, i) => `

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="choice-item ${i === q.answer ? 'correct' : ''}"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â style="cursor:pointer;"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â onclick="app.setCorrectAnswer(${q.id}, ${i})"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â title="Ø§Ø¶ØºØ· Ù„Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${this.escapeHtml(choice)}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`).join('');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (q.answer !== null && q.answer !== undefined && q.answer !== '') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â content += `<div class="choice-item correct">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ${this.escapeHtml(q.answer)}</div>`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  questionDiv.innerHTML = content;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewContainer.appendChild(questionDiv);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  escapeHtml(text) {

Â  Â  Â  Â  Â  Â  Â  Â  if (typeof text !== 'string') return text;

Â  Â  Â  Â  Â  Â  Â  Â  return text

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/&/g, "&amp;")

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/</g, "&lt;")

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/>/g, "&gt;")

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/"/g, "&quot;")

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .replace(/'/g, "&#039;");

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  syntaxHighlight(json) {

Â  Â  Â  Â  Â  Â  Â  Â  json = this.escapeHtml(json);

Â  Â  Â  Â  Â  Â  Â  Â  return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, (match) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let cls = 'number';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (/^"/.test(match)) { cls = /:$/.test(match) ? 'key' : 'string'; }Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (/true|false/.test(match)) { cls = 'boolean'; }Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (/null/.test(match)) { cls = 'null'; }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return '<span class="' + cls + '">' + match + '</span>';

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  async callGeminiAPI(prompt, apiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const payload = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contents: [{ parts: [{ text: prompt }] }],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  generationConfig: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  response_mime_type: "application/json",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  temperature: 0.2,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxOutputTokens: 8192,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_URL, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorBody = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('API Error Response:', errorBody);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(errorBody.error?.message || `ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„Ø­Ø§Ù„Ø© ${response.status}`);

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (!data.candidates || !data.candidates[0].content || !data.candidates[0].content.parts) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Invalid API Response Structure:', data);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© Ù…Ù† API.');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const jsonText = data.candidates[0].content.parts[0].text;

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return JSON.parse(jsonText);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Failed to parse AI response as JSON:", jsonText);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error("ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ Ù‚Ø¯ Ù„Ø§ ØªÙƒÙˆÙ† Ø¨ØµÙŠØºØ© JSON ØµØ­ÙŠØ­Ø©.");

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  toggleLanguage() {

Â  Â  Â  Â  Â  Â  Â  Â  this.language = this.language === 'ar' ? 'en' : 'ar';

Â  Â  Â  Â  Â  Â  Â  Â  this.updateInterfaceLanguage();

Â  Â  Â  Â  Â  Â  Â  Â  this.saveSettings();

Â  Â  Â  Â  Â  Â  Â  Â  const jsonOutput = document.getElementById('jsonOutput');

Â  Â  Â  Â  Â  Â  Â  Â  if (jsonOutput && jsonOutput.style.display === 'block') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.convertToJSON();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  updateInterfaceLanguage() {

Â  Â  Â  Â  Â  Â  Â  Â  const isAr = this.language === 'ar';

Â  Â  Â  Â  Â  Â  Â  Â  document.documentElement.lang = isAr ? 'ar' : 'en';

Â  Â  Â  Â  Â  Â  Â  Â  document.documentElement.dir = isAr ? 'rtl' : 'ltr';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('langSwitchBtn').innerHTML = isAr ? 'ğŸŒ English' : 'ğŸŒ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.header h1').textContent = isAr ? 'ğŸš€ Ù…Ø­ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±' : 'ğŸš€ Advanced Smart Question Converter';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.header p').textContent = isAr ? 'Ø­ÙˆÙ‘Ù„ Ù†ØµÙˆØµ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¥Ù„Ù‰ ØµÙŠØºØ© JSON Ù…ØªÙ‚Ø¯Ù…Ø© Ø¨Ø¶ØºØ·Ø© Ø²Ø±' : 'Convert question texts to advanced JSON format with one click';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.ai-badge').textContent = isAr ? 'ğŸ¤– AI Powered' : 'ğŸ¤– AI Powered';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.panel h3')[0].textContent = isAr ? 'ğŸ“ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©' : 'ğŸ“ Input Questions';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.panel h3')[1].textContent = isAr ? 'ğŸ” ØªØ­Ù„ÙŠÙ„ ÙˆÙ…Ø®Ø±Ø¬Ø§Øª' : 'ğŸ” Analysis & Output';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.panel h3')[2].textContent = isAr ? 'ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©' : 'ğŸ‘ï¸ Questions Preview';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('questionInput').placeholder = isAr ?

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§... Ù…Ø«Ø§Ù„:\n1. Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ù…ØµØ±ØŸ\nØ£) Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©*\nØ¨) Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©\n**********\n2. Ø§Ù„Ø´Ù…Ø³ ØªØ´Ø±Ù‚ Ù…Ù† Ø§Ù„ØºØ±Ø¨. (Ø®Ø·Ø£)\n**********\n3. Ø£ÙƒÙ…Ù„: Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù‡ÙŠ _________'

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  :

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Enter questions here... Example:\n1. What is the capital of Egypt?\nA) Cairo*\nB) Alexandria\n**********\n2. The sun rises from the west. (False)\n**********\n3. Complete: The capital of KSA is _________';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.btn-primary[onclick*="smartAnalyze"]').textContent = isAr ? 'ğŸ¤– ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ' : 'ğŸ¤– Smart Analyze';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('aiEnhanceBtn').innerHTML = isAr ? 'ğŸ’ ØªØ­Ø³ÙŠÙ† Ø¨Ø§Ù„Ù€ AI' : 'ğŸ’ Enhance with AI';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('customizeBtn').innerHTML = isAr ? 'âš™ï¸ ØªØ®ØµÙŠØµ' : 'âš™ï¸ Customize';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.btn-success[onclick*="convertToJSON"]').textContent = isAr ? 'ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ù„Ù€ JSON Ù…ØªÙ‚Ø¯Ù…' : 'ğŸ”„ Convert to Advanced JSON';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.btn-secondary[onclick*="clearAll"]').textContent = isAr ? 'ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„' : 'ğŸ—‘ï¸ Clear All';

Â  Â  Â  Â  Â  Â  Â  Â  const analysisLabels = isAr ? ['Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒØ´Ù:', 'Ø¯Ù‚Ø© Ø§Ù„ØªØµÙ†ÙŠÙ:', 'Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:'] : ['Detection Quality:', 'Classification Accuracy:', 'Data Completeness:'];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.analysis-item span')[0].textContent = analysisLabels[0];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.analysis-item span')[1].textContent = analysisLabels[1];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.analysis-item span')[2].textContent = analysisLabels[2];

Â  Â  Â  Â  Â  Â  Â  Â  const statLabels = isAr ? ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©', 'Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯', 'ØµØ­/Ø®Ø·Ø£', 'Ù…Ù‚Ø§Ù„ÙŠØ©', 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø«Ù‚Ø©'] : ['Total Questions', 'Multiple Choice', 'True/False', 'Essay', 'Unknown', 'Confidence'];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.stat-card h4')[0].textContent = statLabels[0];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.stat-card h4')[1].textContent = statLabels[1];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.stat-card h4')[2].textContent = statLabels[2];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.stat-card h4')[3].textContent = statLabels[3];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.stat-card h4')[4].textContent = statLabels[4];

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.stat-card h4')[5].textContent = statLabels[5];

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('copyBtn').textContent = isAr ? 'ğŸ“‹ Ù†Ø³Ø® JSON' : 'ğŸ“‹ Copy JSON';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadBtn').textContent = isAr ? 'ğŸ’¾ ØªØ­Ù…ÙŠÙ„' : 'ğŸ’¾ Download';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('downloadZipBtn').textContent = isAr ? 'ğŸ—œï¸ ØªØ­Ù…ÙŠÙ„ ÙƒÙ€ ZIP' : 'ğŸ—œï¸ Download as ZIP';

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('csvBtn').textContent = isAr ? 'ğŸ“„ CSV' : 'ğŸ“„ CSV';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('#customizeModal h2').textContent = isAr ? 'ØªØ®ØµÙŠØµ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' : 'Customize Settings';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('label[for="categorySelect"]').textContent = isAr ? 'Ø§Ù„ÙØ¦Ø©' : 'Category';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('label[for="countrySelect"]').textContent = isAr ? 'Ø§Ù„Ø¯ÙˆÙ„Ø©' : 'Country';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('label[for="dialectSelect"]').textContent = isAr ? 'Ø§Ù„Ù„Ù‡Ø¬Ø©' : 'Dialect';

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('#customizeModal .btn-primary').textContent = isAr ? 'Ø­ÙØ¸' : 'Save';

Â  Â  Â  Â  Â  Â  Â  Â  const previewContainer = document.getElementById('questionsPreview');

Â  Â  Â  Â  Â  Â  Â  Â  if (this.questions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewContainer.innerHTML = isAr ? `<div style="text-align: center; color: #6b7280; padding: 40px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;"><div style="font-size: 3em; margin-bottom: 20px;">ğŸ“‹</div><p>Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù„ÙŠÙ„</p></div>` : `<div style="text-align: center; color: #6b7280; padding: 40px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;"><div style="font-size: 3em; margin-bottom: 20px;">ğŸ“‹</div><p>Questions preview will appear here after analysis</p></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  setCorrectAnswer(questionId, choiceIndex) {

Â  Â  Â  Â  Â  Â  Â  Â  const q = this.questions.find(q => q.id === questionId);

Â  Â  Â  Â  Â  Â  Â  Â  if (!q || !Array.isArray(q.choices)) return;

Â  Â  Â  Â  Â  Â  Â  Â  q.answer = choiceIndex;

Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange('ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  saveSettings() {

Â  Â  Â  Â  Â  Â  Â  Â  const settings = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customization: this.customization,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  language: this.language

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('aiq_settings', JSON.stringify(settings));

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  loadSettings() {

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const settings = JSON.parse(localStorage.getItem('aiq_settings'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (settings) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (settings.customization) this.customization = settings.customization;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (settings.language) this.language = settings.language;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } catch {}

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  saveApiKey() {

Â  Â  Â  Â  Â  Â  Â  Â  const apiKey = document.getElementById('apiKey').value.trim();

Â  Â  Â  Â  Â  Â  Â  Â  this.apiKey = apiKey;

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('aiq_api_key', apiKey);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  loadApiKey() {

Â  Â  Â  Â  Â  Â  Â  Â  const apiKey = localStorage.getItem('aiq_api_key');

Â  Â  Â  Â  Â  Â  Â  Â  if (apiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.apiKey = apiKey;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  startEditQuestion(questionId) {

Â  Â  Â  Â  Â  Â  Â  Â  const q = this.questions.find(q => q.id === questionId);

Â  Â  Â  Â  Â  Â  Â  Â  if (!q) return;

Â  Â  Â  Â  Â  Â  Â  Â  q._editing = true;

Â  Â  Â  Â  Â  Â  Â  Â  this.displayResults();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  saveEditQuestion(questionId) {

Â  Â  Â  Â  Â  Â  Â  Â  const q = this.questions.find(q => q.id === questionId);

Â  Â  Â  Â  Â  Â  Â  Â  if (!q) return;

Â  Â  Â  Â  Â  Â  Â  Â  const questionInput = document.getElementById(`edit-question-${questionId}`);

Â  Â  Â  Â  Â  Â  Â  Â  if (questionInput) q.question = questionInput.value;

Â  Â  Â  Â  Â  Â  Â  Â  if (q.choices) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  q.choices = q.choices.map((c, i) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const choiceInput = document.getElementById(`edit-choice-${questionId}-${i}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return choiceInput ? choiceInput.value : c;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  q._editing = false;

Â  Â  Â  Â  Â  Â  Â  Â  this.updateUIAfterChange('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª');

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  cancelEditQuestion(questionId) {

Â  Â  Â  Â  Â  Â  Â  Â  const q = this.questions.find(q => q.id === questionId);

Â  Â  Â  Â  Â  Â  Â  Â  if (!q) return;

Â  Â  Â  Â  Â  Â  Â  Â  q._editing = false;

Â  Â  Â  Â  Â  Â  Â  Â  this.displayResults();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // ===== NEW: CSV Logic =====

Â  Â  Â  Â  Â  Â  openCSVModal() {

Â  Â  Â  Â  Â  Â  Â  Â  if (typeof Handsontable === 'undefined') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('Ø®Ø·Ø£: Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Handsontable) Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.', 'error');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (this.questions.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ ÙØªØ­ Ø¬Ø¯ÙˆÙ„ CSV', 'warning');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const columns = [

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {data: 'Question Id', type: 'text'},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {data: 'Lang', type: 'text', readOnly: true},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {data: 'Lesson Id', type: 'text'},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {data: 'Attributes', type: 'text', readOnly: true},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {data: 'Category', type: 'text', readOnly: true},

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {data: 'Dialect', type: 'text', readOnly: true}

Â  Â  Â  Â  Â  Â  Â  Â  ];

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const saved = localStorage.getItem('aiq_csv_data');

Â  Â  Â  Â  Â  Â  Â  Â  let savedData = null;

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  savedData = JSON.parse(saved);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!Array.isArray(savedData) || savedData.length !== this.questions.length) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  savedData = null;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  savedData = null;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  if (savedData) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.csvData = savedData;

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // UPDATED: Use the new lang setting for the CSV column

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const defaultLang = this.customization.lang || 'ar';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const defaultCategory = this.customization.category || 'lesson';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const defaultDialect = this.customization.dialect || 'Modern_standard';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.csvData = this.questions.map((q, idx) => ({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Question Id': q.id,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Lang': defaultLang,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Lesson Id': '',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Attributes': q.type === 'multiple_choice' ? 'mcq' : (q.type || ''),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Category': defaultCategory,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Dialect': defaultDialect

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('csvModalBg').style.display = 'flex';

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (this.hotInstance) this.hotInstance.destroy();

Â  Â  Â  Â  Â  Â  Â  Â  this.hotInstance = new Handsontable(document.getElementById('hotTable'), {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: this.csvData,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colHeaders: ['Question Id', 'Lang', 'Lesson Id', 'Attributes', 'Category', 'Dialect'],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  columns: columns,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rowHeaders: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: 500,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  licenseKey: 'non-commercial-and-evaluation',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualColumnResize: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  manualRowResize: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stretchH: 'all',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allowInsertRow: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allowRemoveRow: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contextMenu: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  afterChange: () => this.validateCSV(),

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  this.validateCSV();

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  closeCSVModal() {

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('csvModalBg').style.display = 'none';

Â  Â  Â  Â  Â  Â  Â  Â  if (this.hotInstance) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.hotInstance.destroy();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.hotInstance = null;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  saveCSVData() {

Â  Â  Â  Â  Â  Â  Â  Â  if (this.hotInstance) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tableData = this.hotInstance.getData();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.csvData = tableData.map(row => ({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Question Id': row[0],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Lang': row[1],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Lesson Id': row[2],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Attributes': row[3],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Category': row[4],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Dialect': row[5]

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('aiq_csv_data', JSON.stringify(this.csvData));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.showMessage('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª CSV Ø¨Ù†Ø¬Ø§Ø­', 'success');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.closeCSVModal();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.displayResults();Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  validateCSV() {

Â  Â  Â  Â  Â  Â  Â  Â  if (!this.hotInstance) return;

Â  Â  Â  Â  Â  Â  Â  Â  const ids = new Set();

Â  Â  Â  Â  Â  Â  Â  Â  let hasDuplicate = false;

Â  Â  Â  Â  Â  Â  Â  Â  const data = this.hotInstance.getData();

Â  Â  Â  Â  Â  Â  Â  Â  for(let i = 0; i < data.length; i++) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = data[i][0];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (id !== null && id !== '') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ids.has(id)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hasDuplicate = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ids.add(id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const warn = document.getElementById('csvWarning');

Â  Â  Â  Â  Â  Â  Â  Â  warn.style.display = hasDuplicate ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  Â  Â  warn.textContent = 'ØªØ­Ø°ÙŠØ±: ÙŠÙˆØ¬Ø¯ Question Id Ù…ÙƒØ±Ø±!';

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  getCSVString() {

Â  Â  Â  Â  Â  Â  Â  Â  const header = ['Question Id', 'Lang', 'Lesson Id', 'Attributes', 'Category', 'Dialect'];

Â  Â  Â  Â  Â  Â  Â  Â  const rows = this.csvData.map(row =>Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  header.map(h => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cell = row[h] || '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `"${cell.toString().replace(/"/g, '""')}"`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }).join(',')

Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  return [header.join(',')].concat(rows).join('\n');

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  const app = new AIQuestionConverter();



Â  Â  Â  Â  // FIX: Initialization code is now run after all scripts are loaded,

Â  Â  Â  Â  // because this inline script is at the very end of the body.

Â  Â  Â  Â  // The 'load' event listener is no longer necessary.

Â  Â  Â  Â  app.updateInterfaceLanguage();

Â  Â  Â  Â  document.getElementById('categorySelect').value = app.customization.category;

Â  Â  Â  Â  document.getElementById('langSelect').value = app.customization.lang;

Â  Â  Â  Â  document.getElementById('countrySelect').value = app.customization.country;

Â  Â  Â  Â  document.getElementById('dialectSelect').value = app.customization.dialect;

Â  Â  Â  Â  if (app.apiKey) {

Â  Â  Â  Â  Â  Â  document.getElementById('apiKey').value = app.apiKey;

Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById('apiKey').addEventListener('input', () => app.saveApiKey());

Â  Â  </script>

</body>

</html>
